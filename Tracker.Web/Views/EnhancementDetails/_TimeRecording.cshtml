@model TimeRecordingViewModel

<div class="mb-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
            <h6 class="mb-0"><i class="bi bi-clock-history me-1"></i> Time Recording Summary</h6>
            <small class="text-muted">Consolidated hours by month (all resources)</small>
        </div>
    </div>

    @if (!Model.HasEntries)
    {
        <div class="alert alert-info">
            <i class="bi bi-info-circle me-1"></i>
            No time entries recorded for this work item yet.
        </div>
    }
    else
    {
        <div class="table-responsive">
            <table class="table table-sm table-hover">
                <thead class="table-light">
                    <tr>
                        <th style="width: 120px;">Month</th>
                        <th>Work Phases</th>
                        <th class="text-end" style="width: 80px;">Total</th>
                        <th class="text-end" style="width: 80px;">Contrib.</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var month in Model.MonthlySummaries.OrderByDescending(m => m.SortKey))
                    {
                        <tr>
                            <td class="fw-medium text-nowrap">
                                @month.MonthYearDisplay
                                @if (month.ResourceCount > 1)
                                {
                                    <br /><small class="text-muted">@month.ResourceCount resources</small>
                                }
                            </td>
                            <td>
                                <div class="d-flex flex-wrap gap-1">
                                    @foreach (var phase in Model.WorkPhases.OrderBy(p => p.DisplayOrder))
                                    {
                                        var hours = month.HoursByPhase.GetValueOrDefault(phase.Id, 0);
                                        if (hours > 0)
                                        {
                                            <span class="badge @phase.BadgeClass" title="@phase.Name: @hours.ToString("0.#") hours">
                                                @phase.Code: @hours.ToString("0.#")
                                            </span>
                                        }
                                    }
                                </div>
                            </td>
                            <td class="text-end fw-bold">@month.TotalHours.ToString("0.#")</td>
                            <td class="text-end text-muted">@month.TotalContributed.ToString("0.#")</td>
                        </tr>
                    }
                </tbody>
                <tfoot class="table-light fw-bold">
                    <tr>
                        <td>Grand Total</td>
                        <td>
                            <div class="d-flex flex-wrap gap-1">
                                @foreach (var phase in Model.WorkPhases.OrderBy(p => p.DisplayOrder))
                                {
                                    var total = Model.GrandTotalsByPhase.GetValueOrDefault(phase.Id, 0);
                                    if (total > 0)
                                    {
                                        <span class="badge @phase.BadgeClass" title="@phase.Name: @total.ToString("0.#") hours">
                                            @phase.Code: @total.ToString("0.#")
                                        </span>
                                    }
                                }
                            </div>
                        </td>
                        <td class="text-end">@Model.GrandTotal.ToString("0.#")</td>
                        <td class="text-end text-muted">@Model.GrandTotalContributed.ToString("0.#")</td>
                    </tr>
                </tfoot>
            </table>
        </div>
    }
</div>
